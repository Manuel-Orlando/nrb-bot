<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NRB Bot - Desafios</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #fff;
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        padding: 40px 0;
      }
      h1 {
        font-size: 3em;
        margin-bottom: 10px;
        color: #4cc9f0;
      }
      .subtitle {
        color: #aaa;
        font-size: 1.2em;
        margin-bottom: 30px;
      }
      .stats {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
        flex-wrap: wrap;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        min-width: 150px;
        backdrop-filter: blur(10px);
      }
      .stat-number {
        font-size: 2.5em;
        font-weight: bold;
        color: #4cc9f0;
      }
      .stat-label {
        color: #aaa;
        margin-top: 5px;
      }
      .desafios-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 40px;
      }
      .desafio-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        border-left: 5px solid #4cc9f0;
        transition: transform 0.3s;
      }
      .desafio-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.1);
      }
      .desafio-id {
        font-size: 0.9em;
        color: #4cc9f0;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .desafio-ign {
        font-size: 1.5em;
        margin-bottom: 5px;
      }
      .desafio-classe {
        color: #aaa;
        margin-bottom: 15px;
        font-size: 1.1em;
      }
      .desafio-info {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        font-size: 0.9em;
      }
      .status {
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: bold;
      }
      .status-ativo {
        background: #2ecc71;
        color: #fff;
      }
      .status-aceito {
        background: #3498db;
        color: #fff;
      }
      .btn {
        display: inline-block;
        background: #4cc9f0;
        color: #000;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 10px;
        transition: background 0.3s;
      }
      .btn:hover {
        background: #3aa8d8;
      }
      footer {
        text-align: center;
        margin-top: 50px;
        color: #666;
        padding: 20px;
        border-top: 1px solid #333;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #aaa;
      }
      .error {
        text-align: center;
        padding: 40px;
        color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
        border-radius: 10px;
      }
      @media (max-width: 768px) {
        .desafios-grid {
          grid-template-columns: 1fr;
        }
        h1 {
          font-size: 2em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üéØ NRB Desafios</h1>
        <p class="subtitle">
          Acompanhe em tempo real os desafios do bot NRB no Discord
        </p>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="total-desafios">0</div>
            <div class="stat-label">Desafios Ativos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="desafios-aceitos">0</div>
            <div class="stat-label">Aceitos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="classes-diferentes">0</div>
            <div class="stat-label">Classes</div>
          </div>
        </div>

        <a href="https://discord.gg/" target="_blank" class="btn"
          >üéÆ Entrar no Discord</a
        >
      </header>

      <main>
        <h2>üìä Desafios Ativos</h2>
        <div id="desafios-container" class="loading">
          Carregando desafios...
        </div>
      </main>

      <footer>
        <p>NRB Bot ¬© 2024 ‚Ä¢ Atualizado automaticamente a cada 5 minutos</p>
        <p>
          Para iniciar um desafio, use <code>!desafio SeuIGN</code> no Discord
        </p>
      </footer>
    </div>

    <script>
      async function carregarDesafios() {
        try {
          const response = await fetch("./data.json?v=" + Date.now());
          if (!response.ok) throw new Error("Erro ao carregar dados");

          const desafios = await response.json();
          exibirDesafios(desafios);
          atualizarEstatisticas(desafios);
        } catch (error) {
          document.getElementById("desafios-container").innerHTML = `
                    <div class="error">
                        <h3>‚ùå Erro ao carregar dados</h3>
                        <p>${error.message}</p>
                        <p>Tente recarregar a p√°gina em alguns instantes.</p>
                    </div>
                `;
        }
      }

      function exibirDesafios(desafios) {
        const container = document.getElementById("desafios-container");

        if (desafios.length === 0) {
          container.innerHTML =
            '<div class="loading">Nenhum desafio ativo no momento.</div>';
          return;
        }

        let html = '<div class="desafios-grid">';

        desafios.forEach((desafio) => {
          const statusClass = desafio.aceito ? "status-aceito" : "status-ativo";
          const statusText = desafio.aceito ? "ACEITO" : "ATIVO";

          html += `
                <div class="desafio-card">
                    <div class="desafio-id">#${desafio.id}</div>
                    <div class="desafio-ign">${desafio.ign}</div>
                    <div class="desafio-classe">üé≠ ${desafio.classe}</div>
                    
                    <div class="desafio-info">
                        <div>
                            <div>üë§ ${desafio.username}</div>
                            <div>‚è∞ ${desafio.tempo}</div>
                        </div>
                        <div>
                            <span class="status ${statusClass}">${statusText}</span>
                            <div style="margin-top: 5px;">üîÑ ${desafio.rerolls}/2</div>
                        </div>
                    </div>
                    
                    <a href="./challenge.html?id=${desafio.id}" class="btn">Ver detalhes</a>
                </div>
                `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      function atualizarEstatisticas(desafios) {
        // Total de desafios
        document.getElementById("total-desafios").textContent = desafios.length;

        // Desafios aceitos
        const aceitos = desafios.filter((d) => d.aceito).length;
        document.getElementById("desafios-aceitos").textContent = aceitos;

        // Classes diferentes
        const classes = [...new Set(desafios.map((d) => d.classe))];
        document.getElementById("classes-diferentes").textContent =
          classes.length;
      }

      // Carregar dados inicialmente
      carregarDesafios();

      // Atualizar a cada 30 segundos
      setInterval(carregarDesafios, 30000);

      // Atualizar contador de tempo a cada minuto
      setInterval(() => {
        if (window.location.pathname.includes("challenge.html")) {
          const params = new URLSearchParams(window.location.search);
          const id = params.get("id");
          if (id) carregarDetalhesDesafio(id);
        }
      }, 60000);
    </script>
  </body>
</html>
